<!DOCTYPE html>
<html lang="en">
 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
 
    <link href="style2.css" rel="stylesheet">
    <title>登录客户端</title>

</head>
 
<body onload="randoms()">
    <section>
        <!-- 背景颜色 -->
        <div class="color"></div>
        <div class="color"></div>
        <div class="color"></div>
        <div class="box">
            <!-- 背景圆 -->
            <div class="circle" style="--x:0"></div>
            <div class="circle" style="--x:1"></div>
            <div class="circle" style="--x:2"></div>
            <div class="circle" style="--x:3"></div>
            <div class="circle" style="--x:4"></div>
            <!-- 登录框 -->
            <div class="container">
                <div class="form">
                    <h2>登录</h2>
                    <div>
                        <form id="loginForm" onsubmit="login(); return false;">
							<div>
                            <label for="username">用户名:</label>
                            <input type="text" id="username" required>
							</div>
							<div>
                            <label for="password">密码: </label>
                            <input type="password" id="password" required>
							</div>
                            <button type="submit">登录</button>
                        </form>
                    </div>
                    <div id="loginResult"></div>
                </div>
            </div>
        </div>
    </section>
	<script>
		export async function onRequest(context) {
		  // 提取POST请求的用户名和密码
		  const requestBody = await context.request.json();
		  const { username, password } = requestBody;
		
		  // 获取D1数据库绑定
		  const database = context.env.NORTHWIND_DB;
		
		  try {
		    // 使用D1数据库查询用户名和密码
		    const user = await database.query({
		      text: 'SELECT * FROM users WHERE username = $1 AND password = $2',
		      args: [username, password]
		    });
		
		    // 如果找到匹配的用户，则返回成功消息
		    if (user.length > 0) {
		      return new Response(JSON.stringify({ success: true }), {
		        headers: {
		          'Content-Type': 'application/json'
		        }
		      });
		    } else {
		      // 如果没有匹配的用户，则返回错误消息
		      return new Response(JSON.stringify({ success: false, message: '用户名或密码错误' }), {
		        headers: {
		          'Content-Type': 'application/json'
		        }
		      });
		    }
		  } catch (error) {
		    console.error('数据库查询失败:', error);
		    // 如果数据库查询出现错误，则返回错误消息
		    return new Response(JSON.stringify({ success: false, message: '登录失败，请稍后重试' }), {
		      headers: {
		        'Content-Type': 'application/json'
		      }
		    });
		  }
		}

		
	</script>
</body>
 
</html>
